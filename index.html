<script src="https://cdn.jsdelivr.net/gh/netizenorg/netnet-standard-library/build/nn.min.js"></script>
<script src="https://unpkg.com/tone"></script>
<body>
</body>
<script>
/* global nn, Tone*/
  
const synth = new Tone.Synth().toDestination()

const flatKeysTreble = ["A", "B", "D", "E"]
const flatKeysBass = ["A", "B", "D", "E"]


const reverb = new Tone.Reverb({
  wet: 0.75,
  decay: 5
}).toDestination()

const piano = new Tone.Sampler({
  baseUrl: "https://tonejs.github.io/audio/salamander/",
  urls: {
    'A0': 'A0.mp3',
    'C1': 'C1.mp3',
    'D#1': 'Ds1.mp3',
    'F#1': 'Fs1.mp3',
    'A1': 'A1.mp3',
    'C2': 'C2.mp3',
    'D#2': 'Ds2.mp3',
    'F#2': 'Fs2.mp3',
    'A2': 'A2.mp3',
    'C3': 'C3.mp3',
    'D#3': 'Ds3.mp3',
    'F#3': 'Fs3.mp3',
    'A3': 'A3.mp3',
    'C4': 'C4.mp3',
    'D#4': 'Ds4.mp3',
    'F#4': 'Fs4.mp3',
    'A4': 'A4.mp3',
    'C5': 'C5.mp3',
    'D#5': 'Ds5.mp3',
    'F#5': 'Fs5.mp3',
    'A5': 'A5.mp3',
    'C6': 'C6.mp3',
    'D#6': 'Ds6.mp3',
    'F#6': 'Fs6.mp3',
    'A6': 'A6.mp3',
    'C7': 'C7.mp3',
    'D#7': 'Ds7.mp3',
    'F#7': 'Fs7.mp3',
    'A7': 'A7.mp3',
    'C8': 'C8.mp3'
  },
  release: 1
})

piano.connect(reverb)

const firstMeasure = ["E5", "B4", "G4", "E5", "B4", "G4", "E5", "B4"]
const secondMeasure = ["D5", "B4", "F4", "D5", "B4", "F4", "D5", "B4"]
const thirdMeasure = ["C5", "A4", "F4", "C5", "A4", "F4", "C5", "A4"]
  
function playClocks(notes) {
  const now = Tone.now();
  const length = notes.length
  const eachIntroNote = 0.25
  for (let i = 0; i < notes.length; i++) {
    let currNote = notes[i]
    if (flatKeysTreble.includes(currNote[0])) {
      currNote = currNote[0] + "b" + currNote[1]
    }
    piano.triggerAttackRelease(currNote, "8n", now + eachIntroNote * i)
  }
  let offset = now + eachIntroNote * length
  let finalTime = playSecond(offset-0.4)
  // finalTime = now-0.5
  playSecond(finalTime+0.5)
}
  
  
function playSecond(offset) {
  piano.triggerAttackRelease("Eb5", "2n", offset + 0.5)
  piano.triggerAttackRelease("Eb5", "2n", offset + 1)
  piano.triggerAttackRelease("Eb5", "2n", offset + 1.5)
  piano.triggerAttackRelease("Eb5", "8n", offset + 2)
  piano.triggerAttackRelease("C5", "8n", offset + 2.25)
  piano.triggerAttackRelease("Db5", "8n", offset + 2.5)
  piano.triggerAttackRelease("C5", "4n", offset + 3)
  piano.triggerAttackRelease("Bb4", "2n", offset + 3.25)

  
  piano.triggerAttackRelease("Db5", "4n", offset + 4.5)
  piano.triggerAttackRelease("Db5", "4n", offset + 5)
  piano.triggerAttackRelease("Db5", "4n", offset + 5.5)
  piano.triggerAttackRelease("Db5", "8n", offset + 5.75)
  piano.triggerAttackRelease("Bb4", "8n", offset + 6)
  piano.triggerAttackRelease("C5", "8n", offset + 6.5)
  piano.triggerAttackRelease("Bb4", "8n", offset + 6.75)
  piano.triggerAttackRelease("Ab4", "2n", offset + 7.25)
  return offset+7.5
}
  
let notes = firstMeasure.concat(secondMeasure, secondMeasure, thirdMeasure)

let intro = notes.concat(notes)

const fontSize = 90
const emoji = nn.create('span')
    .content('⏰')
    .css({
      position: 'absolute',
      fontSize: fontSize,
      cursor: 'pointer',
      left: nn.width/2 - fontSize/2,
      top: nn.height/2 - fontSize/2
    })
    .addTo('body')
    .on('click', () => playClocks(intro))

    
</script>